###### <center> 金渡教育VIP内部资料，请勿外传，违者必究。
###### <center>主讲老师：金渡教育Casey
---
#### 兄弟组件传值
兄弟组件中,使用eventbus事件总线进行通信,采用发布-订阅event bus进行
1. 下载events：
```cmd
yarn add -D events
```
2. 新建一个event.js文件写入以下内容：
```js
import { EventEmitter } from "events"

// 导入事件总线,利用这个对象发射和监听事件,这个对象是全局的
const eventBus = new EventEmitter()

export default eventBus
```
3. 在需要发送事件的页面引入eventBus,然后使用emit发送事件
```js
// 发送事件eventBus.emit('事件名', 参数)
eventBus.emit('sayHello', name, arr)
```
4. 在需要接收事件的页面引入eventBus,然后使用addListener监听事件
```js
// 添加事件监听,监听从header组件发送过来的sayHello事件
componentDidMount() {
    eventBus.addListener('sayHello', this.sayHelloListener)
}
// 处理事件监听
sayHelloListener(a, b){
    console.log(a, b) // 这样就拿到从另一个兄弟组件中传过来的值了
}
```
5. 移除事件监听,在生命周期componentWillUnmount中进行
```js
// 移除事件监听
componentWillUnmount() {
    eventBus.removeListener('sayHello', this.sayHelloListener)
}
```

##### 组件优化
在开发过程中,肯定会出现层层嵌套的关系组件,当我们使用Component时,
父组件中的state或者props发生更新时,无论子组件中的state和props是否更新,
都会触发子组件的更新,会导致很多没有必要的render,浪费很多性能。

我们可以在子组件中使用shouldComponentUpdate(nextProps, nextState)这个生命周期来让子组件不更新,
但是这种方法并不推荐,因为我们需要手动的给每个子组件的这个生命周期中去添加判断条件。

所以一般我们会使用PureComponent来代替Component进行组件的优化。
简单来说就是PureComponent实现了shouldComponentUpdate。
在React中,PureComponent通过props和state的浅比较,浅比较是react源码中的一个内置函数,
它替代了shouldComponentUpdate的工作,它只比较外层数据结构,只要外层相同,则认为没有变化,不会深层次去比较数据。
**PureComponent原理：当组件更新的时候,如果组件的props和state都没有发生改变的时候,render方法就不会触发，省去了virtualDOM的生成和对比的过程,所以它能达到提升新能的目的。**
PureComponent只能在一些纯展示的组件上
PureComponent存在的一些问题：
1、不可以在函数式组件上使用
2、进行浅比较，深层次的数据不一致，有可能会导致页面得不到更新。
3、不太适合使用在含有多层嵌套对象的state和props中。

##### setState
1. 为什么要使用setState?
因为我们修改了状态state的时候,希望React根据最新的state来重新渲染界面,直接修改的方式,react并不会知道状态发生了改变。react没有实现类似于Vue2中Object.defineProperty或者是Vue3 proxy的方式来监听数据的变化,必须通过setState来告知react状态的改变。setState是继承自Component,当我们调用setState的时候,会重新执行render方法。

2. 思考：setState是'异步'的吗？

##### ref
组件不是真实的DOM节点,在react开发中,官方也不建议直接去操作原生的DOM。组件的DOM节点是存在于内存中的一种数据结构,叫做虚拟DOM。如果需要从组件中获取真实的DOM节点,那就需要官方提供ref的属性。React提供了ref用于访问在render方法中创建的DOM元素或者是React的组件实例。
ref分为三种，我们这里先学两种。

- string类型(已经被淘汰掉了)
- createRef创建(官方推荐,16.3之后的版本使用这个)
