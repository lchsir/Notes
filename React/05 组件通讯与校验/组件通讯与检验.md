###### <center> 金渡教育VIP内部资料，请勿外传，违者必究。
###### <center>主讲老师：金渡教育Casey
---
#### 组件通讯与校验
##### 组件通讯
组件通讯简单来讲就是各类关系组件间的通讯操作,最常见的无非就是父子组件、兄弟组件。而最常见和最常用的也就是父子组件之间的通讯,但是在我们学习的过程中我们会发现一个比较有意思的事情,那就是可能没有永恒的父子组件或者兄弟组件的关系。在我们React中组件经过拆分过后,都变成了比较小的一块,为了让组件可复用性和可组合性更高,最终组件的使用形态是非常多变的。

###### 父子组件通信
组件通信一般比较常用的就是父传子、子传父、以及跨组件之间的通信。父传子用props,子传父用props通过回调函数的形式。props传值又涉及到校验的问题。

##### 参数校验
对于组件之间的通信数据，更多时候我们希望能够进行验证。这样能够提高我们代码的可读性，也能够提高团队协同开发的效率。在我们的项目开发过程中，参数校验非常重要。Vue中使用Flow做静态类型检查,在React中使用prop-types进行校验。
```cmd
# 15以后的版本我们的prop-types是另外的包,需要手动下载
yarn add -D prop-types
```
```js
// 下载完成后在子组件中引入
import PropTypes from 'prop-types'

// 使用语法：组件名.propTypes添加一个属性,属性值为对象
Son.propTypes = {
    name: PropTypes.string.isRequired, // 给isRequired属性代表的必传项,不传就会报错.
    age: PropTypes.number
}

// 还可以使用defaultProps指定它的默认值,那么我们调用子组件的时候不传值也不会报错
Son.defaultProps = {
    name: 'jianan',
    age: 18
}
```

###### 跨组件通信
父子传值比较简单，也好理解，所以这里说一下跨组件通信的两种解决方案：
1. 用props层层传递
2. 用Context
Context提供了一个无需为每层组件手动添加props,就能在组件树间进行数据传递的方法。Context 设计目的是为了共享那些对于一个组件树而言是“全局”的数据，例如当前认证的用户、主题或首选语言。
- Context使用步骤
```jsx
// context.js中内容
import React from 'react'
// 创建一个 Context 对象，组件会从组件树中离自身最近的那个匹配的 Provider 中读取到当前的 context 值。
const MainContext = React.createContext('这里面可以设置默认值')

export default MainContext
```
```jsx
// 传值使用Provider接收value属性,传递给消费组件
<MainContext.Provider value={/* 某个值 */}>
```
```jsx
// 接收值由两种方法
// 1、使用Context.Consumer(多用于函数式组件)
<MainContext.Consumer>
  {value => /* 基于 context 值进行渲染*/}
</MainContext.Consumer>
// 2、用Class.contextType挂载在class上,然后使用 this.context 来消费最近 Context 上的那个值。可以在任何生命周期中访问到它，包括 render 函数中。(多用于类组件)
static contextType = MainContext
// 或者
Hello.contextType = MainContext 
// 就可以直接用this.context访问了
```

##### 生命周期
生命周期其实就是从创建到销毁的整个过程，我们发现很多框架都涉及到生命周期，为什么这些框架需要设计生命周期呢，是因为我们需要了解我们代码的执行过程。以及它们的执行顺序是怎样的，同时在不同的生命周期阶段会暴露不同的构造函数，而在不同的构造函数中我们可以做很多不同的功能。在React中一个由extends Component创建的类组件才会拥有生命周期。

**React生命周期四个阶段**
- 组件初始化阶段：
getInitialState：初始化 this.state 的值，只在组件装载之前调用一次
getDefaultProps：只在组件创建时调用一次并缓存返回的对象（即在 React.createClass 之后就会调用）。
因为这个方法在实例初始化之前调用，所以在这个方法里面不能依赖 this 获取到这个组件的实例。
- 组件加载阶段：
componentWillMount：只会在装载之前调用一次
componentDidMount：只会在装载完成之后调用一次
- 组件更新阶段：
componentWillReceiveProps 、shouldComponentUpdate、componentWillUpdate、componentDidUpdate这些方法不会在首次render组件的 周期调用。
- 组件销毁阶段：
componentWillUnmount：卸载组件触发
